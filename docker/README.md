# Плохой докер и его фикс

### Проблема 1 — Использование `ubuntu:latest`

`latest` указывает на последнию версию, со временем, образ понятное дело меняется, и следовательно, нет гарантии что получиться именна та сборка, которую задумывал разработчик(((((

**Фикс**  
В хорошем докере используется `python:3.11-slim` —> сборка стабилна, предсказуема и всегда работает 

**Результат:**  
Образ стал меньше, стабильнее и быстрее собирается.


### Проблема 2 — Все команды в одной RUN и без очистки
  
Так нельзя использовать кеш докер, и образ накапливает кучу мусора (apt-кэша, временных файлов)

**Фикс**  
В хорошем докерфайле сначала копируется `requirements.txt`, устанавливаются зависимости с `--no-cache-dir`, а потом уже копируется проект.  

**Результат:**  
Docker правильно кэширует слои → пересборка быстрее и образ меньше.


### Проблема 3 — Работа под root
  
Контейнер имеет полный доступ внутри — если кто-то получит доступ к нему, может потенциально навредить хосту.  

**Исправление:**  
Добавлен отдельный пользователь `appuser` и команда `USER appuser`.  

**Результат:**  
Контейнер безопаснее. Даже если взломают, вред минимален.


# Тутор: как убить рабочий докерфайл

### 1. Хранить данные прямо внутри контейнера

Докер контейнер - временная история, если будет какой нибудь деплой, а он будет все данные в контейнере сотруться навсегда. Так что логи и файлики не сохраняем в контейнер

### 2. Не ограничивать ресурсы при запуске контейнера


По умолчанию контейнер может использовать всю оперативку и CPU хоста.
Если приложение начнёт есть память или уйдёт в бесконечный цикл - рип сервак.
Так что нужно юзать --memory или тип того и все будет хорошо